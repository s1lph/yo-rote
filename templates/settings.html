{% extends "base.html" %}
{% set show_menu = True %}

{% block title %}Общие настройки - yo.route{% endblock %}

{% block content %}
<div class="form-container" style="max-width: 800px;">
    <div class="page-header">
        <h1 class="page-title">Общие настройки</h1>
    </div>

    <form action="/api/settings" method="POST" data-method="PUT">
        <div class="list-section">
            <h2 class="section-title">Внешний вид</h2>

            <div class="form-group">
                <label class="form-label" for="theme">Тема оформления</label>
                <select id="theme" name="theme" class="form-select">
                    <option value="light">Светлая</option>
                    <option value="dark">Тёмная (в разработке)</option>
                </select>
            </div>
        </div>

        <div class="list-section">
            <h2 class="section-title">Рабочее пространство</h2>

            <div class="form-group">
                <label class="form-label" for="default_page">Стартовая вкладка</label>
                <select id="default_page" name="default_page" class="form-select">
                    <option value="orders">Заказы</option>
                    <option value="optimization">Планирование маршрута</option>
                    <option value="points">Точки отправки</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" for="planning_mode">Планирование маршрутов</label>
                <select id="planning_mode" name="planning_mode" class="form-select">
                    <option value="manual">Ручное управление</option>
                    <option value="smart">Автоматически собирать предложения</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" for="courier_notifications">Уведомления курьерам</label>
                <select id="courier_notifications" name="courier_notifications" class="form-select">
                    <option value="off">Не отправлять</option>
                    <option value="on">Отправлять автоматически</option>
                </select>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Сохранить</button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Загрузка настроек
    document.addEventListener('DOMContentLoaded', async function() {
        const themeSelect = document.getElementById('theme');
        const defaultPageSelect = document.getElementById('default_page');
        const planningModeSelect = document.getElementById('planning_mode');
        const courierNotificationsSelect = document.getElementById('courier_notifications');

        if (themeSelect) {
            const savedTheme = localStorage.getItem('theme') || 'light';
            themeSelect.value = savedTheme;
            applyTheme(savedTheme);
            themeSelect.addEventListener('change', function(e) {
                applyTheme(e.target.value);
            });
        }

        try {
            const settingsData = await api.get('/api/settings');
            if (settingsData.settings) {
                if (defaultPageSelect) {
                    defaultPageSelect.value = settingsData.settings.default_page || 'orders';
                }
                if (planningModeSelect) {
                    planningModeSelect.value = settingsData.settings.planning_mode || 'manual';
                }
                if (courierNotificationsSelect) {
                    courierNotificationsSelect.value = settingsData.settings.courier_notifications || 'off';
                }
                if (themeSelect && settingsData.settings.theme) {
                    themeSelect.value = settingsData.settings.theme;
                    applyTheme(settingsData.settings.theme);
                }
            }
        } catch (error) {
            console.error('Error loading settings:', error);
        }
    });

    // Используем глобальную функцию applyTheme из main.js
</script>
{% endblock %}